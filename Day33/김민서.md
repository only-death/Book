# 39장. DOM

### 39.6 DOM 조작

**DOM 조작**은 새 노드를 만들고 추가하거나 기존 노드를 삭제하거나 교체하는 작업을 말한다.

이 과정은 리플로우(Reflow)와 리페인트(Repaint)를 유발해서 성능에 영향을 줄 수 있기 때문에, 복잡한 콘텐츠를 다룰 때는 특히 신경 써야 한다.

### 39.6.1 innerHTML

요소 노드의 `innerHTML` 프로퍼티를 참조하면 시작 태그와 종료 태그 사이에 있는 모든 HTML 마크업을 문자열로 반환한다.

`textContent`는 텍스트만 반환하는 반면, `innerHTML`은 HTML 태그까지 포함한 문자열을 반환한다.

또한 `innerHTML`에 문자열을 할당하면 기존 자식 노드를 모두 삭제하고, 할당한 HTML 문자열을 새롭게 파싱해 DOM에 반영한다.

주의할 점은 사용자 입력을 그대로 `innerHTML`에 할당하면 크로스 사이트 스크립팅(XSS) 공격에 노출될 수 있다는 것이다.

또한 `innerHTML`을 사용할 경우 전체 자식 노드를 새로 파싱하고 반영하기 때문에 성능적으로도 부담이 있다. 삽입 위치를 세밀하게 지정할 수도 없다.

### 39.6.2 insertAdjacentHTML 메서드

`insertAdjacentHTML(position, DOMString)` 메서드는 기존 요소를 삭제하지 않고, 원하는 위치에 새로운 HTML 문자열을 삽입할 수 있다.

`position` 값은 `'beforebegin'`, `'afterbegin'`, `'beforeend'`, `'afterend'` 중 하나를 사용할 수 있다.

`innerHTML`보다 효율적이고 빠르지만, 마찬가지로 XSS 공격에 대한 주의는 필요하다.

### 39.6.3 노드 생성과 추가

DOM은 HTML 문자열을 직접 삽입하는 것 외에도 노드를 생성하고 추가하는 다양한 메서드를 제공한다.

#### 요소 노드 생성

`document.createElement(tagName)` 메서드를 사용하면 요소 노드를 직접 생성할 수 있다.

생성된 요소는 아직 DOM에 추가되지 않은 상태로, 독립적으로 존재한다.

#### 텍스트 노드 생성

`document.createTextNode(text)` 메서드를 사용하면 텍스트 노드를 생성할 수 있다.

역시 생성된 텍스트 노드는 바로 DOM에 추가되지 않고 따로 존재한다.

#### 텍스트 노드를 요소 노드의 자식 노드로 추가

`appendChild(childNode)` 메서드를 이용해 생성한 텍스트 노드를 요소 노드의 자식으로 추가할 수 있다.

자식 노드가 없는 요소에 텍스트를 추가할 땐 `textContent`를 사용하는 것이 더 간편하다.

#### 요소 노드를 DOM에 추가

`appendChild`를 이용해 완성된 요소 노드를 기존 DOM에 추가하면, 이때 비로소 DOM이 변경되면서 리플로우와 리페인트가 발생한다.

### 39.6.4 복수의 노드 생성과 추가

여러 개의 노드를 반복해서 DOM에 추가하면 추가할 때마다 리플로우와 리페인트가 발생해 성능이 떨어진다.

이 문제를 해결하려고 임시로 `div` 같은 컨테이너를 사용할 수도 있지만, 불필요한 요소가 추가되는 부작용이 있다.

보다 좋은 방법은 `DocumentFragment`를 사용하는 것이다.

`DocumentFragment`는 메모리상에서만 존재하며, 이를 DOM에 추가하면 자식 노드만 이동되고 자신은 제거된다.

그래서 여러 요소를 한 번에 추가할 때 훨씬 효율적이다.

### 39.6.5 노드 삽입

#### 마지막 노드로 추가

`appendChild`는 항상 마지막 자식 노드로 새 노드를 추가한다.

삽입 위치를 선택할 수는 없다.

#### 지정한 위치에 노드 삽입

`insertBefore(newNode, referenceNode)` 메서드를 사용하면 특정 노드 앞에 새 노드를 삽입할 수 있다.

참고로 `referenceNode`가 없으면 `appendChild`처럼 마지막에 추가된다.

### 39.6.6 노드 이동

이미 DOM에 존재하는 노드라도 `appendChild`나 `insertBefore`를 다시 호출하면 기존 위치에서 제거된 후 새 위치로 이동한다.

즉, 별도의 삭제 없이 위치를 옮길 수 있다.

### 39.6.7 노드 복사

`cloneNode(deep)` 메서드는 노드를 복사한다.

- `true`를 넘기면 모든 자손 노드까지 복사하는 깊은 복사
- `false`를 넘기거나 생략하면 자기 자신만 복사하는 얕은 복사

얕은 복사일 경우 텍스트 노드 등 자식 노드는 복사되지 않는다.

### 39.6.8 노드 교체

`replaceChild(newChild, oldChild)` 메서드를 사용하면 기존 노드를 새로운 노드로 교체할 수 있다.

교체가 끝나면 `oldChild`는 DOM에서 제거된다.

### 39.6.9 노드 삭제

`removeChild(child)` 메서드를 사용하면 특정 자식 노드를 DOM에서 삭제할 수 있다.

삭제된 노드는 메모리에서 제거되지는 않고, 필요하면 변수에 참조를 남겨둘 수 있다.

